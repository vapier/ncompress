# Makefile generated by build.

# C compiler
#CC=cc

# C compiler optimization flags
CFLAGS=-O3

# Install prefix
DESTDIR=

# Install directory for binarys
BINDIR=/usr/local/bin

# Install directory for manual
MANDIR=/usr/local/man/man1

# compiler options:
# options is a collection of:
#
#	-DAMIGA=1					Amiga support.
#	-DNOFUNCDEF=1				Disable libary function definitions in
#								compress42.c
#	-DDIRENT=1					Use dirent.h
#	-DSYSDIR=1					Use sys/dir.h
#	-DLSTAT=1					Use lstat for finding symlinks.
#	-DUTIME_H=1					Use utime.h
#	-DUSERMEM=<size>			Availble memory for compress (default 800k).
#	-DREGISTERS=<nbr>			Number of registers (default 2).
#	-DIBUFSIZ=<size>			Input buffer size (default BUFSIZ).
#	-DOBUFSIZ=<size>			Output buffer size (default BUFSIZ)
#	-DBYTEORDER=<order>			Byte order (default: unknown).
#	-DNOALLIGN=1				Data word allignment (default: yes).
#	-DDEF_ERRNO=1				Define error (not defined in errno.h).
#	-DMAXSEG_64K=1 -BITS=16		Support segment processsor like 80286.
#
options= $(CFLAGS) $(CPPFLAGS) -DDIRENT=1 -DUSERMEM=800000 -DREGISTERS=3

# libary options
LBOPT= $(LDFLAGS)


compress:	Makefile compress42.c patchlevel.h
	$(CC) -o compress $(options) compress42.c $(LBOPT)

install:	compress
		[ -f $(DESTDIR)$(BINDIR)/compress ] && \
			{ rm -f $(DESTDIR)$(BINDIR)/compress.old ; \
	  		mv $(DESTDIR)$(BINDIR)/compress $(DESTDIR)$(BINDIR)/compress.old ; } || :
		rm -f $(DESTDIR)$(BINDIR)/uncompress $(DESTDIR)$(BINDIR)/zcat
		mkdir -p $(DESTDIR)$(BINDIR) $(DESTDIR)$(MANDIR)
		cp compress $(DESTDIR)$(BINDIR)/compress
		strip $(DESTDIR)$(BINDIR)/compress
		rm -f $(DESTDIR)$(BINDIR)/uncompress
		ln $(DESTDIR)$(BINDIR)/compress $(DESTDIR)$(BINDIR)/uncompress
		rm -f $(DESTDIR)$(BINDIR)/zcat
		ln -f $(DESTDIR)$(BINDIR)/compress $(DESTDIR)$(BINDIR)/zcat
		cp zcmp zdiff zmore $(DESTDIR)$(BINDIR)/.
		chmod 0755 $(DESTDIR)$(BINDIR)/compress $(DESTDIR)$(BINDIR)/zcmp $(DESTDIR)$(BINDIR)/zdiff $(DESTDIR)$(BINDIR)/zmore
		cp compress.1 zcmp.1 zmore.1 $(DESTDIR)$(MANDIR)/.
		chmod 0644 $(DESTDIR)$(MANDIR)/compress.1 $(DESTDIR)$(MANDIR)/zcmp.1 $(DESTDIR)$(MANDIR)/zmore.1

cleanup:
		rm -f compress compress.def comp.log
